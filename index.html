<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìš°ë¦¬ ê°€ì¡± í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 15px; min-height: 100vh; }
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px; margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    .login-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 40px; text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      max-width: 450px; margin: 80px auto;
    }
    .main-app { display: none; }
    .nav-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .nav-tab {
      background: rgba(255, 255, 255, 0.8);
      border: none; padding: 10px 18px;
      border-radius: 25px; cursor: pointer; transition: all 0.3s ease;
      font-weight: 500; font-size: 14px;
    }
    .nav-tab:hover { background: rgba(102, 126, 234, 0.2); }
    .nav-tab.active { background: #667eea; color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
    .content-section { display: none; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); min-height: 400px; }
    .content-section.active { display: block; animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
    .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 14px; transition: all 0.3s ease; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; display: inline-block;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
    .btn:active { transform: translateY(0); }
    .btn-danger { background: linear-gradient(135deg, #ff6b6b, #ee5a24); padding: 8px 16px; font-size: 12px; }
    .btn-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
    .btn-info { background: linear-gradient(135deg, #3498db, #2980b9); }
    .card { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 16px; border-left: 4px solid #667eea; transition: all 0.3s ease; }
    .card:hover { transform: translateX(3px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 20px; }
    .calendar-day { background: #f8f9fa; border: 1px solid #e1e5e9; border-radius: 8px; padding: 8px; min-height: 80px; font-size: 12px; }
    .calendar-day.today { background: #667eea; color: white; }
    .calendar-header { background: #667eea; color: white; text-align: center; padding: 12px 8px; font-weight: bold; border-radius: 8px; }
    .expense-item { display: flex; justify-content: space-between; align-items: flex-start; padding: 16px; background: #f8f9fa; border-radius: 10px; margin-bottom: 12px; }
    .amount { font-weight: bold; color: #e74c3c; }
    .income { color: #27ae60; }
    .user-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
    .admin-badge { background: #e74c3c; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; margin-left: 10px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; text-align: center; }
    .stat-number { font-size: 2.2em; font-weight: bold; margin-bottom: 8px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 1000; }
    .modal-content { background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; margin: 5% auto; position: relative; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); }
    .close { position: absolute; right: 20px; top: 20px; font-size: 28px; cursor: pointer; color: #999; }
    .close:hover { color: #333; }
    .sheets-status { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 10px 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; font-size: 14px; }
    .sheets-status.disconnected { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    @media (max-width: 768px) {
      .container { padding: 10px; }
      .nav-tabs { justify-content: center; }
      .stats-grid { grid-template-columns: 1fr; }
      .calendar { gap: 4px; }
      .calendar-day { min-height: 60px; }
      .expense-item { flex-direction: column; gap: 10px; }
      .user-info { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="login-container">
      <h2 style="margin-bottom: 30px; color: #333;">ìš°ë¦¬ ê°€ì¡± í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
      <div class="form-group">
        <label for="loginId">ì•„ì´ë””</label>
        <input type="text" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
      </div>
      <div class="form-group">
        <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
      </div>
      <button class="btn" id="loginBtn">ë¡œê·¸ì¸</button>
      <p style="margin-top: 20px; font-size: 12px; color: #666;">
        ë°ëª¨ ê³„ì •: admin/admin (ìš´ì˜ì), dad/dad (ì•„ë¹ ), mom/mom (ì—„ë§ˆ), son/son (ì•„ë“¤)
      </p>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div id="mainApp" class="main-app">
      <div class="header">
        <div id="sheetsStatus" class="sheets-status disconnected">
          ğŸ“Š Google Sheets ì—°ê²° ì•ˆë¨ - "Sheets ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
        </div>
        <div class="user-info">
          <div>
            <h1>ìš°ë¦¬ ê°€ì¡± í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <span id="welcomeMessage"></span>
            <span id="adminBadge" class="admin-badge" style="display: none;">ìš´ì˜ì</span>
          </div>
          <div>
            <button class="btn btn-success" id="btnSheets">ğŸ“Š Sheets ì—°ê²°</button>
            <button class="btn btn-info" id="btnSync">ğŸ”„ ë™ê¸°í™”</button>
            <button class="btn" id="btnLogout">ë¡œê·¸ì•„ì›ƒ</button>
          </div>
        </div>
        <div class="nav-tabs">
          <button class="nav-tab active" data-section="dashboard">ëŒ€ì‹œë³´ë“œ</button>
          <button class="nav-tab" data-section="blog">ê°€ì¡± ë¸”ë¡œê·¸</button>
          <button class="nav-tab" data-section="budget">ê°€ê³„ë¶€</button>
          <button class="nav-tab" data-section="calendar">ì¼ì •í‘œ</button>
          <button class="nav-tab" data-section="finance">ì¬ì •í˜„í™©</button>
          <button class="nav-tab" id="adminTab" style="display: none;" data-section="admin">ê´€ë¦¬ì</button>
        </div>
      </div>

      <!-- ëŒ€ì‹œë³´ë“œ -->
      <div id="dashboard" class="content-section active">
        <h2>ëŒ€ì‹œë³´ë“œ</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalBudget">â‚©0</div>
            <div>ì´ë²ˆ ë‹¬ ì§€ì¶œ</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="blogCount">0</div>
            <div>ì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="scheduleCount">0</div>
            <div>ì´ë²ˆ ì£¼ ì¼ì •</div>
          </div>
        </div>
        <h3>ìµœê·¼ í™œë™</h3>
        <div id="recentActivity"></div>
      </div>

      <!-- ê°€ì¡± ë¸”ë¡œê·¸ -->
      <div id="blog" class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>ê°€ì¡± ë¸”ë¡œê·¸</h2>
          <button class="btn" id="btnNewPost">ìƒˆ í¬ìŠ¤íŠ¸ ì‘ì„±</button>
        </div>
        <div id="blogPosts"></div>
      </div>

      <!-- ê°€ê³„ë¶€ -->
      <div id="budget" class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>ê°€ê³„ë¶€</h2>
          <button class="btn" id="btnNewBudget">ìˆ˜ì…/ì§€ì¶œ ì¶”ê°€</button>
        </div>
        <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">
          <div class="stat-card">
            <div class="stat-number income" id="totalIncome">â‚©0</div>
            <div>ì´ ìˆ˜ì…</div>
          </div>
          <div class="stat-card">
            <div class="stat-number amount" id="totalExpense">â‚©0</div>
            <div>ì´ ì§€ì¶œ</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="netAmount">â‚©0</div>
            <div>ìˆœìˆ˜ì…</div>
          </div>
        </div>
        <div id="budgetItems"></div>
      </div>

      <!-- ì¼ì •í‘œ -->
      <div id="calendar" class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>ì¼ì •í‘œ</h2>
          <button class="btn" id="btnNewSchedule">ìƒˆ ì¼ì • ì¶”ê°€</button>
        </div>
        <div id="calendarView"></div>
      </div>

      <!-- ì¬ì •í˜„í™© -->
      <div id="finance" class="content-section">
        <h2>ì¬ì •í˜„í™© ê²Œì‹œíŒ</h2>
        <div id="financeBoard"></div>
      </div>

      <!-- ê´€ë¦¬ì í˜ì´ì§€ -->
      <div id="admin" class="content-section">
        <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
          <div class="card">
            <h3>ì‚¬ìš©ì ê´€ë¦¬</h3>
            <div id="userList"></div>
          </div>
          <div class="card">
            <h3>ì‹œìŠ¤í…œ í†µê³„</h3>
            <div id="systemStats"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ ëª¨ë‹¬ -->
  <div id="blogModal" class="modal">
    <div class="modal-content">
      <span class="close" data-close="blogModal">&times;</span>
      <h3>ìƒˆ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì‘ì„±</h3>
      <div class="form-group">
        <label>ì œëª©</label>
        <input type="text" id="blogTitle" />
      </div>
      <div class="form-group">
        <label>ë‚´ìš©</label>
        <textarea id="blogContent" rows="6"></textarea>
      </div>
      <button class="btn" id="btnSavePost">í¬ìŠ¤íŠ¸ ì‘ì„±</button>
    </div>
  </div>

  <!-- ê°€ê³„ë¶€ ëª¨ë‹¬ -->
  <div id="budgetModal" class="modal">
    <div class="modal-content">
      <span class="close" data-close="budgetModal">&times;</span>
      <h3>ìˆ˜ì…/ì§€ì¶œ ì¶”ê°€</h3>
      <div class="form-group">
        <label>êµ¬ë¶„</label>
        <select id="budgetType">
          <option value="income">ìˆ˜ì…</option>
          <option value="expense">ì§€ì¶œ</option>
        </select>
      </div>
      <div class="form-group">
        <label>ë‚´ìš©</label>
        <input type="text" id="budgetDescription" />
      </div>
      <div class="form-group">
        <label>ê¸ˆì•¡</label>
        <input type="number" id="budgetAmount" />
      </div>
      <div class="form-group">
        <label>ì¹´í…Œê³ ë¦¬</label>
        <select id="budgetCategory">
          <option value="ì‹ë¹„">ì‹ë¹„</option>
          <option value="êµí†µë¹„">êµí†µë¹„</option>
          <option value="ìƒí™œìš©í’ˆ">ìƒí™œìš©í’ˆ</option>
          <option value="ì˜ë£Œë¹„">ì˜ë£Œë¹„</option>
          <option value="êµìœ¡ë¹„">êµìœ¡ë¹„</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>
      </div>
      <button class="btn" id="btnSaveBudget">ì¶”ê°€</button>
    </div>
  </div>

  <!-- ì¼ì • ëª¨ë‹¬ -->
  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <span class="close" data-close="scheduleModal">&times;</span>
      <h3>ìƒˆ ì¼ì • ì¶”ê°€</h3>
      <div class="form-group">
        <label>ì œëª©</label>
        <input type="text" id="scheduleTitle" />
      </div>
      <div class="form-group">
        <label>ë‚ ì§œ</label>
        <input type="date" id="scheduleDate" />
      </div>
      <div class="form-group">
        <label>ì‹œê°„</label>
        <input type="time" id="scheduleTime" />
      </div>
      <div class="form-group">
        <label>ë‚´ìš©</label>
        <textarea id="scheduleDescription" rows="3"></textarea>
      </div>
      <button class="btn" id="btnSaveSchedule">ì¼ì • ì¶”ê°€</button>
    </div>
  </div>

  <script>
    // ===== ì „ì—­ ìƒíƒœ =====
    let currentUser = null;
    const users = {
      admin: { password: 'admin', name: 'ê´€ë¦¬ì', role: 'admin' },
      dad: { password: 'dad', name: 'ì•„ë¹ ', role: 'user' },
      mom: { password: 'mom', name: 'ì—„ë§ˆ', role: 'user' },
      son: { password: 'son', name: 'ì•„ë“¤', role: 'user' },
    };
    let blogPosts = [];
    let budgetItems = [];
    let schedules = [];

    // Google Sheets ì—°ë™
    let sheetsApiUrl = '';

    // ===== ìœ í‹¸ =====
    function saveData() {
      try {
        const data = {
          blogPosts,
          budgetItems,
          schedules,
          lastSaved: new Date().toISOString(),
        };
        localStorage.setItem('familyData', JSON.stringify(data));
        console.log('âœ… ë°ì´í„° ì €ì¥ ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ì €ì¥ ì˜¤ë¥˜:', error);
      }
    }

    function loadData() {
      try {
        const data = localStorage.getItem('familyData');
        if (data) {
          const parsed = JSON.parse(data);
          blogPosts = (parsed.blogPosts || []).map((post) => ({ ...post, date: post.date ? new Date(post.date) : null }));
          budgetItems = (parsed.budgetItems || []).map((item) => ({ ...item, date: item.date ? new Date(item.date) : null }));
          schedules = (parsed.schedules || []).map((s) => ({ ...s, date: s.date ? new Date(s.date) : null }));
          console.log('âœ… ê¸°ì¡´ ë°ì´í„° ë¡œë“œë¨');
        } else {
          // ì´ˆê¸° ë°ëª¨ ë°ì´í„°
          blogPosts = [
            { id: 1, title: 'ê°€ì¡± ì—¬í–‰ ê³„íš', content: 'ì´ë²ˆ ì—¬ë¦„íœ´ê°€ ê³„íšì„ ì„¸ì›Œë³´ì•˜ìŠµë‹ˆë‹¤.', author: 'ì—„ë§ˆ', date: new Date('2025-08-01'), authorId: 'mom' },
          ];
          budgetItems = [
            { id: 1, type: 'expense', description: 'ë§ˆíŠ¸ ì¥ë³´ê¸°', amount: 150000, category: 'ì‹ë¹„', author: 'ì—„ë§ˆ', date: new Date('2025-08-20'), authorId: 'mom' },
            { id: 2, type: 'income', description: 'ì›”ê¸‰', amount: 3000000, category: 'ê¸‰ì—¬', author: 'ì•„ë¹ ', date: new Date('2025-08-01'), authorId: 'dad' },
          ];
          schedules = [
            { id: 1, title: 'ê°€ì¡± ì™¸ì‹', date: new Date('2025-08-25'), time: '18:00', description: 'ì €ë… ì™¸ì‹', author: 'ì—„ë§ˆ', authorId: 'mom' },
          ];
          saveData();
          console.log('âœ… ì´ˆê¸° ë°ëª¨ ë°ì´í„° ìƒì„±ë¨');
        }
      } catch (error) {
        console.error('âŒ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    function updateSheetsStatus(connected) {
      const statusEl = document.getElementById('sheetsStatus');
      if (!statusEl) return;
      if (connected) {
        statusEl.textContent = 'ğŸ“Š Google Sheets ì—°ê²°ë¨ - ê°€ì¡± ê°„ ë°ì´í„° ê³µìœ  ê°€ëŠ¥!';
        statusEl.className = 'sheets-status';
      } else {
        statusEl.textContent = 'ğŸ“Š Google Sheets ì—°ê²° ì•ˆë¨ - "Sheets ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”';
        statusEl.className = 'sheets-status disconnected';
      }
    }

    async function testConnection() {
      if (!sheetsApiUrl) return;
      try {
        const response = await fetch(sheetsApiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'test' }),
        });
        const result = await response.json();
        if (result.success) {
          updateSheetsStatus(true);
          console.log('âœ… Google Sheets ì—°ê²° ì„±ê³µ');
        } else {
          updateSheetsStatus(false);
          console.log('âŒ Google Sheets ì—°ê²° ì‹¤íŒ¨');
        }
      } catch (error) {
        console.error('âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
        updateSheetsStatus(false);
      }
    }

    async function saveToSheets(type, data) {
      if (!sheetsApiUrl) {
        console.log('Google Sheets URLì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
        return false;
      }
      try {
        const response = await fetch(sheetsApiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'save', type, data }),
        });
        const result = await response.json();
        if (result.success) {
          console.log('âœ… Google Sheets ì €ì¥ ì„±ê³µ:', type);
          return true;
        }
        console.error('âŒ Sheets ì €ì¥ ì‹¤íŒ¨:', result.error);
        return false;
      } catch (error) {
        console.error('âŒ Sheets ì €ì¥ ì˜¤ë¥˜:', error);
        return false;
      }
    }

    async function syncWithSheets() {
      if (!sheetsApiUrl) {
        alert('âŒ Google Sheets URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.\n\n"ğŸ“Š Sheets ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
        return;
      }
      try {
        const response = await fetch(sheetsApiUrl, {
          method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'load' }),
        });
        const result = await response.json();
        if (result.success && result.data) {
          parseSheetData(result.data);
          renderAll();
          alert('ğŸ”„ ë™ê¸°í™” ì™„ë£Œ!\n\nGoogle Sheetsì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
        } else {
          alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨\n\nGoogle Sheetsì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë™ê¸°í™” ì˜¤ë¥˜:', error);
        alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨\n\n' + error.message);
      }
    }

    function parseSheetData(sheetData) {
      const newBlogPosts = [];
      const newBudgetItems = [];
      const newSchedules = [];
      (sheetData || []).slice(1).forEach((row) => {
        if (row[1] && row[2]) {
          try {
            const data = JSON.parse(row[2]);
            if (row[1] === 'blog') newBlogPosts.push({ ...data, date: new Date(data.date) });
            else if (row[1] === 'budget') newBudgetItems.push({ ...data, date: new Date(data.date) });
            else if (row[1] === 'schedule') newSchedules.push({ ...data, date: new Date(data.date) });
          } catch (e) {
            console.error('ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
          }
        }
      });
      blogPosts = mergeById(blogPosts, newBlogPosts);
      budgetItems = mergeById(budgetItems, newBudgetItems);
      schedules = mergeById(schedules, newSchedules);
      saveData();
    }

    function mergeById(existing, incoming) {
      const map = new Map(existing.map((x) => [x.id, x]));
      for (const it of incoming) if (!map.has(it.id)) map.set(it.id, it);
      return Array.from(map.values());
    }

    // ===== ì¸ì¦ =====
    function loginUser() {
      const id = document.getElementById('loginId').value.trim();
      const pw = document.getElementById('loginPassword').value;
      if (users[id] && users[id].password === pw) {
        currentUser = { id, ...users[id] };
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('welcomeMessage').textContent = currentUser.name + 'ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!';
        if (currentUser.role === 'admin') {
          document.getElementById('adminBadge').style.display = 'inline-block';
          document.getElementById('adminTab').style.display = 'block';
        }
        const savedUrl = localStorage.getItem('sheetsApiUrl');
        if (savedUrl) { sheetsApiUrl = savedUrl; updateSheetsStatus(true); } else { updateSheetsStatus(false); }
        loadData();
        renderAll();
        if (currentUser.role === 'admin') loadAdminPanel();
      } else {
        alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    }

    function logoutUser() {
      currentUser = null;
      document.getElementById('loginScreen').style.display = 'block';
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('adminBadge').style.display = 'none';
      document.getElementById('adminTab').style.display = 'none';
      document.getElementById('loginId').value = '';
      document.getElementById('loginPassword').value = '';
      showTab('dashboard');
    }

    // ===== íƒ­ & ë Œë” =====
    function showTab(section) {
      document.querySelectorAll('.content-section').forEach((s) => s.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach((t) => t.classList.remove('active'));
      const target = document.getElementById(section);
      if (target) target.classList.add('active');
      const btn = document.querySelector(`.nav-tab[data-section="${section}"]`);
      if (btn) btn.classList.add('active');
    }

    function renderAll() {
      updateDashboard();
      loadBlogPosts();
      loadBudgetItems();
      loadSchedules();
      loadFinanceBoard();
    }

    function updateDashboard() {
      const now = new Date();
      const currentMonth = now.getMonth();
      const monthlyExpenses = budgetItems
        .filter((i) => i && i.type === 'expense' && i.date && i.date.getMonth() === currentMonth)
        .reduce((sum, i) => sum + (Number(i.amount) || 0), 0);
      const totalBudgetEl = document.getElementById('totalBudget');
      if (totalBudgetEl) totalBudgetEl.textContent = 'â‚©' + monthlyExpenses.toLocaleString();
      const blogCountEl = document.getElementById('blogCount');
      if (blogCountEl) blogCountEl.textContent = blogPosts.length;
      const scheduleCountEl = document.getElementById('scheduleCount');
      if (scheduleCountEl) scheduleCountEl.textContent = schedules.length;

      const recentActivity = document.getElementById('recentActivity');
      if (!recentActivity) return;
      recentActivity.innerHTML = '';
      const recent = [
        ...blogPosts.slice(-3).map((data) => ({ type: 'blog', data })),
        ...budgetItems.slice(-3).map((data) => ({ type: 'budget', data })),
        ...schedules.slice(-3).map((data) => ({ type: 'schedule', data })),
      ]
        .filter((a) => a.data && a.data.date)
        .sort((a, b) => new Date(b.data.date) - new Date(a.data.date))
        .slice(0, 5);

      recent.forEach((activity) => {
        const card = document.createElement('div');
        card.className = 'card';
        let content = '';
        if (activity.type === 'blog') {
          content = `${activity.data.author || 'ìµëª…'}ë‹˜ì´ "${activity.data.title || 'ì œëª©ì—†ìŒ'}" ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.`;
        } else if (activity.type === 'budget') {
          const type = activity.data.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ';
          content = `${activity.data.author || 'ìµëª…'}ë‹˜ì´ ${type} "${activity.data.description || 'ì„¤ëª…ì—†ìŒ'}"ì„(ë¥¼) â‚©${(activity.data.amount || 0).toLocaleString()}ìœ¼ë¡œ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.`;
        } else {
          content = `${activity.data.author || 'ìµëª…'}ë‹˜ì´ "${activity.data.title || 'ì œëª©ì—†ìŒ'}" ì¼ì •ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`;
        }
        const dateStr = activity.data.date ? new Date(activity.data.date).toLocaleDateString() : 'ë‚ ì§œì—†ìŒ';
        card.innerHTML = `<p><strong>${content}</strong></p><small style="color:#666;">${dateStr}</small>`;
        recentActivity.appendChild(card);
      });
    }

    function loadBlogPosts() {
      const container = document.getElementById('blogPosts');
      if (!container) return; container.innerHTML = '';
      (blogPosts || [])
        .slice()
        .sort((a, b) => (b.date ? new Date(b.date) : 0) - (a.date ? new Date(a.date) : 0))
        .forEach((post) => {
          const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.id === post.authorId);
          const el = document.createElement('div');
          el.className = 'card';
          const title = post.title || 'ì œëª©ì—†ìŒ';
          const content = post.content || 'ë‚´ìš©ì—†ìŒ';
          const author = post.author || 'ìµëª…';
          const date = post.date ? new Date(post.date).toLocaleDateString() : 'ë‚ ì§œì—†ìŒ';
          el.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;">
              <div style="flex:1;">
                <h3 style="margin-bottom:10px;">${title}</h3>
                <p style="margin-bottom:10px;">${content}</p>
                <small style="color:#666;">ì‘ì„±ì: ${author} | ë‚ ì§œ: ${date}</small>
              </div>
              ${canEdit ? `<button class="btn btn-danger" data-remove-post="${post.id}">ì‚­ì œ</button>` : ''}
            </div>`;
          container.appendChild(el);
        });
    }

    function loadBudgetItems() {
      const container = document.getElementById('budgetItems');
      if (!container) return; container.innerHTML = '';
      let totalIncome = 0, totalExpense = 0;
      (budgetItems || [])
        .slice()
        .sort((a, b) => (b.date ? new Date(b.date) : 0) - (a.date ? new Date(a.date) : 0))
        .forEach((item) => {
          if (item.type === 'income') totalIncome += Number(item.amount) || 0; else totalExpense += Number(item.amount) || 0;
          const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.id === item.authorId);
          const el = document.createElement('div');
          el.className = 'expense-item';
          const dateStr = item.date ? new Date(item.date).toLocaleDateString() : 'ë‚ ì§œì—†ìŒ';
          el.innerHTML = `
            <div>
              <strong>${item.description || 'ì„¤ëª…ì—†ìŒ'}</strong><br/>
              <small>ì¹´í…Œê³ ë¦¬: ${item.category || 'ê¸°íƒ€'} | ${item.author || 'ìµëª…'} | ${dateStr}</small>
            </div>
            <div style="text-align:right;">
              <div class="${item.type === 'income' ? 'income' : 'amount'}">${item.type === 'income' ? '+' : '-'}â‚©${(item.amount || 0).toLocaleString()}</div>
              ${canEdit ? `<button class="btn btn-danger" data-remove-budget="${item.id}">ì‚­ì œ</button>` : ''}
            </div>`;
          container.appendChild(el);
        });
      const ti = document.getElementById('totalIncome'); if (ti) ti.textContent = 'â‚©' + totalIncome.toLocaleString();
      const te = document.getElementById('totalExpense'); if (te) te.textContent = 'â‚©' + totalExpense.toLocaleString();
      const net = document.getElementById('netAmount'); if (net) net.textContent = 'â‚©' + (totalIncome - totalExpense).toLocaleString();
    }

    function loadSchedules() {
      const container = document.getElementById('calendarView');
      if (!container) return; container.innerHTML = '';
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const calendarHeader = document.createElement('h3');
      calendarHeader.textContent = `${year}ë…„ ${month + 1}ì›”`;
      calendarHeader.style.textAlign = 'center';
      calendarHeader.style.marginBottom = '20px';
      container.appendChild(calendarHeader);
      const daysOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      const grid = document.createElement('div'); grid.className = 'calendar';
      daysOfWeek.forEach((d) => { const h = document.createElement('div'); h.className = 'calendar-header'; h.textContent = d; grid.appendChild(h); });
      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();
      for (let i = 0; i < firstDay; i++) { const empty = document.createElement('div'); empty.className = 'calendar-day'; grid.appendChild(empty); }
      const today = new Date();
      for (let date = 1; date <= lastDate; date++) {
        const cell = document.createElement('div'); cell.className = 'calendar-day';
        if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) cell.classList.add('today');
        cell.innerHTML = `<strong>${date}</strong>`;
        const daySchedules = (schedules || []).filter((s) => s.date && s.date.getDate() === date && s.date.getMonth() === month && s.date.getFullYear() === year);
        daySchedules.forEach((s) => {
          const d = document.createElement('div');
          d.style.cssText = 'font-size:10px;background:#667eea;color:white;padding:2px 4px;border-radius:4px;margin-top:2px;';
          d.textContent = `${s.time || ''} ${s.title || ''}`;
          cell.appendChild(d);
        });
        grid.appendChild(cell);
      }
      container.appendChild(grid);

      const list = document.createElement('div');
      list.style.marginTop = '30px';
      list.innerHTML = '<h3>ì´ë²ˆ ë‹¬ ì¼ì •</h3>';
      const monthSchedules = (schedules || [])
        .filter((s) => s.date && s.date.getMonth() === month && s.date.getFullYear() === year)
        .sort((a, b) => a.date - b.date);
      monthSchedules.forEach((s) => {
        const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.id === s.authorId);
        const el = document.createElement('div');
        el.className = 'card';
        const dateStr = s.date ? s.date.toLocaleDateString() : 'ë‚ ì§œì—†ìŒ';
        el.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <strong>${s.title || 'ì œëª©ì—†ìŒ'}</strong><br/>
              <small>${dateStr} ${s.time || ''} | ${s.author || 'ìµëª…'}</small><br/>
              <span>${s.description || ''}</span>
            </div>
            ${canEdit ? `<button class="btn btn-danger" data-remove-schedule="${s.id}">ì‚­ì œ</button>` : ''}
          </div>`;
        list.appendChild(el);
      });
      container.appendChild(list);
    }

    function loadFinanceBoard() {
      const container = document.getElementById('financeBoard');
      if (!container) return; container.innerHTML = '';
      const now = new Date();
      const year = now.getFullYear();
      const rows = [];
      for (let i = 0; i < 12; i++) {
        const income = (budgetItems || [])
          .filter((it) => it.type === 'income' && it.date && it.date.getMonth() === i && it.date.getFullYear() === year)
          .reduce((s, it) => s + (Number(it.amount) || 0), 0);
        const expense = (budgetItems || [])
          .filter((it) => it.type === 'expense' && it.date && it.date.getMonth() === i && it.date.getFullYear() === year)
          .reduce((s, it) => s + (Number(it.amount) || 0), 0);
        if (income > 0 || expense > 0) rows.push({ month: `${i + 1}ì›”`, income, expense, net: income - expense });
      }
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h3>${year}ë…„ ì›”ë³„ ì¬ì • í˜„í™©</h3>
        <div style="overflow-x:auto;">
          <table style="width:100%;border-collapse:collapse;margin-top:15px;">
            <thead>
              <tr style="background:#f8f9fa;">
                <th style="padding:10px;border:1px solid #ddd;">ì›”</th>
                <th style="padding:10px;border:1px solid #ddd;">ìˆ˜ì…</th>
                <th style="padding:10px;border:1px solid #ddd;">ì§€ì¶œ</th>
                <th style="padding:10px;border:1px solid #ddd;">ìˆœìˆ˜ì…</th>
              </tr>
            </thead>
            <tbody>
              ${rows
                .map(
                  (m) => `
                <tr>
                  <td style="padding:10px;border:1px solid #ddd;">${m.month}</td>
                  <td style="padding:10px;border:1px solid #ddd;color:#27ae60;">â‚©${m.income.toLocaleString()}</td>
                  <td style="padding:10px;border:1px solid #ddd;color:#e74c3c;">â‚©${m.expense.toLocaleString()}</td>
                  <td style="padding:10px;border:1px solid #ddd;color:${m.net >= 0 ? '#27ae60' : '#e74c3c'};">â‚©${m.net.toLocaleString()}</td>
                </tr>`
                )
                .join('')}
            </tbody>
          </table>
        </div>`;
      container.appendChild(card);
    }

    // ===== ê´€ë¦¬ì =====
    function loadAdminPanel() {
      const userList = document.getElementById('userList');
      if (!userList) return; userList.innerHTML = '';
      Object.entries(users).forEach(([id, user]) => {
        const wrap = document.createElement('div');
        wrap.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f8f9fa;border-radius:8px;margin-bottom:10px;';
        wrap.innerHTML = `
          <div>
            <strong>${user.name}</strong> (${id})<br/>
            <small>ê¶Œí•œ: ${user.role === 'admin' ? 'ê´€ë¦¬ì' : 'ì‚¬ìš©ì'}</small>
          </div>
          ${id !== 'admin' ? `<button class="btn btn-danger" data-remove-user="${id}">ì‚­ì œ</button>` : ''}
        `;
        userList.appendChild(wrap);
      });
      const systemStats = document.getElementById('systemStats');
      if (systemStats) {
        systemStats.innerHTML = `
          <div style="margin-bottom: 15px;"><strong>ì´ ì‚¬ìš©ì:</strong> ${Object.keys(users).length}ëª…</div>
          <div style="margin-bottom: 15px;"><strong>ì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸:</strong> ${blogPosts.length}ê°œ</div>
          <div style="margin-bottom: 15px;"><strong>ì´ ê°€ê³„ë¶€ í•­ëª©:</strong> ${budgetItems.length}ê°œ</div>
          <div style="margin-bottom: 15px;"><strong>ì´ ì¼ì •:</strong> ${schedules.length}ê°œ</div>
          <div style="margin-top: 20px; display:flex; gap:10px; flex-wrap: wrap;">
            <button class="btn" id="btnExport">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn" id="btnClearAll" style="background:#e74c3c;">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
          </div>`;
      }
    }

    function exportData() {
      const data = { users, blogPosts, budgetItems, schedules, exportDate: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'family_data_' + new Date().toISOString().split('T')[0] + '.json';
      document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    }

    function clearAllData() {
      if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      if (!confirm('ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•©ë‹ˆë‹¤. ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;
      blogPosts = []; budgetItems = []; schedules = [];
      saveData(); renderAll(); if (currentUser?.role === 'admin') loadAdminPanel();
      alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ===== ëª¨ë‹¬ =====
    function openModal(id) { const m = document.getElementById(id); if (m) m.style.display = 'block'; }
    function closeModal(id) {
      const m = document.getElementById(id); if (!m) return; m.style.display = 'none';
      if (id === 'blogModal') { document.getElementById('blogTitle').value = ''; document.getElementById('blogContent').value = ''; }
      if (id === 'budgetModal') { document.getElementById('budgetDescription').value = ''; document.getElementById('budgetAmount').value = ''; }
      if (id === 'scheduleModal') {
        document.getElementById('scheduleTitle').value = '';
        document.getElementById('scheduleDate').value = '';
        document.getElementById('scheduleTime').value = '';
        document.getElementById('scheduleDescription').value = '';
      }
    }

    // ===== ìƒì„±/ì €ì¥ =====
    async function saveBlogPost() {
      const title = document.getElementById('blogTitle').value.trim();
      const content = document.getElementById('blogContent').value.trim();
      if (!title || !content) return alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      const newPost = { id: Date.now(), title, content, author: currentUser.name, authorId: currentUser.id, date: new Date() };
      blogPosts.push(newPost); saveData();
      if (sheetsApiUrl) await saveToSheets('blog', newPost);
      loadBlogPosts(); updateDashboard(); closeModal('blogModal');
    }

    async function saveBudgetItem() {
      const type = document.getElementById('budgetType').value;
      const description = document.getElementById('budgetDescription').value.trim();
      const amount = parseInt(document.getElementById('budgetAmount').value, 10);
      const category = document.getElementById('budgetCategory').value;
      if (!description || isNaN(amount)) return alert('ë‚´ìš©ê³¼ ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      const newItem = { id: Date.now(), type, description, amount, category, author: currentUser.name, authorId: currentUser.id, date: new Date() };
      budgetItems.push(newItem); saveData();
      if (sheetsApiUrl) await saveToSheets('budget', newItem);
      loadBudgetItems(); loadFinanceBoard(); updateDashboard(); closeModal('budgetModal');
    }

    async function saveSchedule() {
      const title = document.getElementById('scheduleTitle').value.trim();
      const dateValue = document.getElementById('scheduleDate').value;
      const time = document.getElementById('scheduleTime').value;
      const description = document.getElementById('scheduleDescription').value.trim();
      if (!title || !dateValue || !time) return alert('ì œëª©, ë‚ ì§œ, ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      const date = new Date(dateValue); if (isNaN(date.getTime())) return alert('ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      const newSchedule = { id: Date.now(), title, date, time, description, author: currentUser.name, authorId: currentUser.id };
      schedules.push(newSchedule); saveData();
      if (sheetsApiUrl) await saveToSheets('schedule', newSchedule);
      loadSchedules(); updateDashboard(); closeModal('scheduleModal');
    }

    // ===== ì‚­ì œ í•¸ë“¤ëŸ¬ =====
    function removeBlogPost(id) { if (!confirm('ì •ë§ë¡œ ì´ í¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; blogPosts = blogPosts.filter((p) => p.id !== id); saveData(); loadBlogPosts(); updateDashboard(); }
    function removeBudgetItem(id) { if (!confirm('ì •ë§ë¡œ ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; budgetItems = budgetItems.filter((i) => i.id !== id); saveData(); loadBudgetItems(); loadFinanceBoard(); updateDashboard(); }
    function removeSchedule(id) { if (!confirm('ì •ë§ë¡œ ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; schedules = schedules.filter((s) => s.id !== id); saveData(); loadSchedules(); updateDashboard(); }
    function removeUser(userId) { if (!users[userId]) return; if (!confirm('ì •ë§ë¡œ ' + users[userId].name + ' ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; delete users[userId]; loadAdminPanel(); }

    // ===== ì´ë²¤íŠ¸ ë°”ì¸ë”© =====
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸš€ ê°€ì¡± ê´€ë¦¬ ì‹œìŠ¤í…œ ì‹œì‘');
      const savedUrl = localStorage.getItem('sheetsApiUrl');
      if (savedUrl) { sheetsApiUrl = savedUrl; updateSheetsStatus(true); } else { updateSheetsStatus(false); }
      loadData();

      // ë¡œê·¸ì¸ ê´€ë ¨
      document.getElementById('loginBtn').addEventListener('click', loginUser);
      const loginPassword = document.getElementById('loginPassword');
      loginPassword?.addEventListener('keypress', (e) => { if (e.key === 'Enter') loginUser(); });

      // ìƒë‹¨ ë²„íŠ¼
      document.getElementById('btnLogout').addEventListener('click', logoutUser);
      document.getElementById('btnSheets').addEventListener('click', () => {
        const url = prompt('Google Apps Script ì›¹ ì•± URLì„ ì…ë ¥í•˜ì„¸ìš”:\n\nì˜ˆì‹œ: https://script.google.com/macros/s/ABC123.../exec');
        if (url && url.includes('script.google.com/macros')) {
          sheetsApiUrl = url;
          localStorage.setItem('sheetsApiUrl', url);
          updateSheetsStatus(true);
          alert('âœ… Google Sheets URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ ë°ì´í„°ê°€ Google Sheetsì™€ ë™ê¸°í™”ë©ë‹ˆë‹¤.');
          testConnection();
        } else if (url) {
          alert('âŒ ì˜¬ë°”ë¥¸ Google Apps Script URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\ní˜•ì‹: https://script.google.com/macros/s/.../exec');
        }
      });
      document.getElementById('btnSync').addEventListener('click', syncWithSheets);

      // íƒ­ ì „í™˜ (event ê°ì²´ ì˜ì¡´ ì œê±°: data-section ì‚¬ìš©)
      document.querySelectorAll('.nav-tab').forEach((btn) => {
        btn.addEventListener('click', () => showTab(btn.dataset.section));
      });

      // ëª¨ë‹¬ ì˜¤í”ˆ ë²„íŠ¼
      document.getElementById('btnNewPost').addEventListener('click', () => openModal('blogModal'));
      document.getElementById('btnNewBudget').addEventListener('click', () => openModal('budgetModal'));
      document.getElementById('btnNewSchedule').addEventListener('click', () => {
        openModal('scheduleModal');
        const today = new Date();
        const dateInput = document.getElementById('scheduleDate');
        if (dateInput) dateInput.value = today.toISOString().split('T')[0];
      });

      // ëª¨ë‹¬ ë‹«ê¸° (X ë²„íŠ¼)
      document.querySelectorAll('.close').forEach((x) => {
        x.addEventListener('click', () => closeModal(x.dataset.close));
      });

      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ë‹«ê¸°
      window.addEventListener('click', (e) => {
        document.querySelectorAll('.modal').forEach((m) => { if (e.target === m) m.style.display = 'none'; });
      });

      // ì €ì¥ ë²„íŠ¼ë“¤
      document.getElementById('btnSavePost').addEventListener('click', saveBlogPost);
      document.getElementById('btnSaveBudget').addEventListener('click', saveBudgetItem);
      document.getElementById('btnSaveSchedule').addEventListener('click', saveSchedule);

      // ë™ì  ì‚­ì œ ë²„íŠ¼ ìœ„ì„
      document.body.addEventListener('click', (e) => {
        const t = e.target;
        if (t.matches('[data-remove-post]')) removeBlogPost(Number(t.getAttribute('data-remove-post')));
        if (t.matches('[data-remove-budget]')) removeBudgetItem(Number(t.getAttribute('data-remove-budget')));
        if (t.matches('[data-remove-schedule]')) removeSchedule(Number(t.getAttribute('data-remove-schedule')));
        if (t.matches('[data-remove-user]')) removeUser(String(t.getAttribute('data-remove-user')));
        if (t.id === 'btnExport') exportData();
        if (t.id === 'btnClearAll') clearAllData();
      });

      // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ìë™ ì €ì¥
      window.addEventListener('beforeunload', () => { if (currentUser) saveData(); });

      // ì²« ë Œë”
      renderAll();
      console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
    });
  </script>
</body>
</html>
