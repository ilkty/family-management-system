<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïö∞Î¶¨ Í∞ÄÏ°± ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            margin: 80px auto;
        }

        .main-app {
            display: none;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 400px;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .btn-info {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateX(3px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .calendar-day {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 8px;
            min-height: 80px;
            font-size: 12px;
        }

        .calendar-day.today {
            background: #667eea;
            color: white;
        }

        .calendar-header {
            background: #667eea;
            color: white;
            text-align: center;
            padding: 12px 8px;
            font-weight: bold;
            border-radius: 8px;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .amount {
            font-weight: bold;
            color: #e74c3c;
        }

        .income {
            color: #27ae60;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .admin-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            margin: 5% auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .sheets-status {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }

        .sheets-status.disconnected {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .nav-tabs { justify-content: center; }
            .stats-grid { grid-template-columns: 1fr; }
            .calendar { gap: 4px; }
            .calendar-day { min-height: 60px; }
            .expense-item { flex-direction: column; gap: 10px; }
            .user-info { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ -->
        <div id="loginScreen" class="login-container">
            <h2 style="margin-bottom: 30px; color: #333;">Ïö∞Î¶¨ Í∞ÄÏ°± ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h2>
            <div class="form-group">
                <label for="loginId">ÏïÑÏù¥Îîî</label>
                <input type="text" id="loginId" placeholder="ÏïÑÏù¥ÎîîÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            </div>
            <div class="form-group">
                <label for="loginPassword">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                <input type="password" id="loginPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            </div>
            <button class="btn" onclick="loginUser()">Î°úÍ∑∏Ïù∏</button>
            <p style="margin-top: 20px; font-size: 12px; color: #666;">
                Îç∞Î™® Í≥ÑÏ†ï: admin/admin (Ïö¥ÏòÅÏûê), dad/dad (ÏïÑÎπ†), mom/mom (ÏóÑÎßà), son/son (ÏïÑÎì§)
            </p>
        </div>

        <!-- Î©îÏù∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò -->
        <div id="mainApp" class="main-app">
            <div class="header">
                <div id="sheetsStatus" class="sheets-status disconnected">
                    üìä Google Sheets Ïó∞Í≤∞ ÏïàÎê® - "Sheets Ïó∞Í≤∞" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî
                </div>
                <div class="user-info">
                    <div>
                        <h1>Ïö∞Î¶¨ Í∞ÄÏ°± ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                        <span id="welcomeMessage"></span>
                        <span id="adminBadge" class="admin-badge" style="display: none;">Ïö¥ÏòÅÏûê</span>
                    </div>
                    <div>
                        <button class="btn btn-success" onclick="setupSheetsUrl()" style="margin-right: 10px;">üìä Sheets Ïó∞Í≤∞</button>
                        <button class="btn btn-info" onclick="syncWithSheets()" style="margin-right: 10px;">üîÑ ÎèôÍ∏∞Ìôî</button>
                        <button class="btn" onclick="logoutUser()">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="showTab('dashboard')">ÎåÄÏãúÎ≥¥Îìú</button>
                    <button class="nav-tab" onclick="showTab('blog')">Í∞ÄÏ°± Î∏îÎ°úÍ∑∏</button>
                    <button class="nav-tab" onclick="showTab('budget')">Í∞ÄÍ≥ÑÎ∂Ä</button>
                    <button class="nav-tab" onclick="showTab('calendar')">ÏùºÏ†ïÌëú</button>
                    <button class="nav-tab" onclick="showTab('finance')">Ïû¨Ï†ïÌòÑÌô©</button>
                    <button class="nav-tab" id="adminTab" style="display: none;" onclick="showTab('admin')">Í¥ÄÎ¶¨Ïûê</button>
                </div>
            </div>

            <!-- ÎåÄÏãúÎ≥¥Îìú -->
            <div id="dashboard" class="content-section active">
                <h2>ÎåÄÏãúÎ≥¥Îìú</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalBudget">‚Ç©0</div>
                        <div>Ïù¥Î≤à Îã¨ ÏßÄÏ∂ú</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="blogCount">0</div>
                        <div>Ï¥ù Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="scheduleCount">0</div>
                        <div>Ïù¥Î≤à Ï£º ÏùºÏ†ï</div>
                    </div>
                </div>
                <h3>ÏµúÍ∑º ÌôúÎèô</h3>
                <div id="recentActivity"></div>
            </div>

            <!-- Í∞ÄÏ°± Î∏îÎ°úÍ∑∏ -->
            <div id="blog" class="content-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Í∞ÄÏ°± Î∏îÎ°úÍ∑∏</h2>
                    <button class="btn" onclick="openBlogModal()">ÏÉà Ìè¨Ïä§Ìä∏ ÏûëÏÑ±</button>
                </div>
                <div id="blogPosts"></div>
            </div>

            <!-- Í∞ÄÍ≥ÑÎ∂Ä -->
            <div id="budget" class="content-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Í∞ÄÍ≥ÑÎ∂Ä</h2>
                    <button class="btn" onclick="openBudgetModal()">ÏàòÏûÖ/ÏßÄÏ∂ú Ï∂îÍ∞Ä</button>
                </div>
                <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="stat-card">
                        <div class="stat-number income" id="totalIncome">‚Ç©0</div>
                        <div>Ï¥ù ÏàòÏûÖ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number amount" id="totalExpense">‚Ç©0</div>
                        <div>Ï¥ù ÏßÄÏ∂ú</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="netAmount">‚Ç©0</div>
                        <div>ÏàúÏàòÏûÖ</div>
                    </div>
                </div>
                <div id="budgetItems"></div>
            </div>

            <!-- ÏùºÏ†ïÌëú -->
            <div id="calendar" class="content-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>ÏùºÏ†ïÌëú</h2>
                    <button class="btn" onclick="openScheduleModal()">ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä</button>
                </div>
                <div id="calendarView"></div>
            </div>

            <!-- Ïû¨Ï†ïÌòÑÌô© -->
            <div id="finance" class="content-section">
                <h2>Ïû¨Ï†ïÌòÑÌô© Í≤åÏãúÌåê</h2>
                <div id="financeBoard"></div>
            </div>

            <!-- Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ -->
            <div id="admin" class="content-section">
                <h2>Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card">
                        <h3>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h3>
                        <div id="userList"></div>
                    </div>
                    <div class="card">
                        <h3>ÏãúÏä§ÌÖú ÌÜµÍ≥Ñ</h3>
                        <div id="systemStats"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Î∏îÎ°úÍ∑∏ Î™®Îã¨ -->
    <div id="blogModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBlogModal()">&times;</span>
            <h3>ÏÉà Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏ ÏûëÏÑ±</h3>
            <div class="form-group">
                <label>Ï†úÎ™©</label>
                <input type="text" id="blogTitle">
            </div>
            <div class="form-group">
                <label>ÎÇ¥Ïö©</label>
                <textarea id="blogContent" rows="6"></textarea>
            </div>
            <button class="btn" onclick="saveBlogPost()">Ìè¨Ïä§Ìä∏ ÏûëÏÑ±</button>
        </div>
    </div>

    <!-- Í∞ÄÍ≥ÑÎ∂Ä Î™®Îã¨ -->
    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBudgetModal()">&times;</span>
            <h3>ÏàòÏûÖ/ÏßÄÏ∂ú Ï∂îÍ∞Ä</h3>
            <div class="form-group">
                <label>Íµ¨Î∂Ñ</label>
                <select id="budgetType">
                    <option value="income">ÏàòÏûÖ</option>
                    <option value="expense">ÏßÄÏ∂ú</option>
                </select>
            </div>
            <div class="form-group">
                <label>ÎÇ¥Ïö©</label>
                <input type="text" id="budgetDescription">
            </div>
            <div class="form-group">
                <label>Í∏àÏï°</label>
                <input type="number" id="budgetAmount">
            </div>
            <div class="form-group">
                <label>Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                <select id="budgetCategory">
                    <option value="ÏãùÎπÑ">ÏãùÎπÑ</option>
                    <option value="ÍµêÌÜµÎπÑ">ÍµêÌÜµÎπÑ</option>
                    <option value="ÏÉùÌôúÏö©Ìíà">ÏÉùÌôúÏö©Ìíà</option>
                    <option value="ÏùòÎ£åÎπÑ">ÏùòÎ£åÎπÑ</option>
                    <option value="ÍµêÏú°ÎπÑ">ÍµêÏú°ÎπÑ</option>
                    <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
                </select>
            </div>
            <button class="btn" onclick="saveBudgetItem()">Ï∂îÍ∞Ä</button>
        </div>
    </div>

    <!-- ÏùºÏ†ï Î™®Îã¨ -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeScheduleModal()">&times;</span>
            <h3>ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä</h3>
            <div class="form-group">
                <label>Ï†úÎ™©</label>
                <input type="text" id="scheduleTitle">
            </div>
            <div class="form-group">
                <label>ÎÇ†Ïßú</label>
                <input type="date" id="scheduleDate">
            </div>
            <div class="form-group">
                <label>ÏãúÍ∞Ñ</label>
                <input type="time" id="scheduleTime">
            </div>
            <div class="form-group">
                <label>ÎÇ¥Ïö©</label>
                <textarea id="scheduleDescription" rows="3"></textarea>
            </div>
            <button class="btn" onclick="saveSchedule()">ÏùºÏ†ï Ï∂îÍ∞Ä</button>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentUser = null;
        let users = {
            admin: { password: 'admin', name: 'Í¥ÄÎ¶¨Ïûê', role: 'admin' },
            dad: { password: 'dad', name: 'ÏïÑÎπ†', role: 'user' },
            mom: { password: 'mom', name: 'ÏóÑÎßà', role: 'user' },
            son: { password: 'son', name: 'ÏïÑÎì§', role: 'user' }
        };
        let blogPosts = [];
        let budgetItems = [];
        let schedules = [];

        // Google Sheets Ïó∞Îèô Î≥ÄÏàò
        let sheetsApiUrl = localStorage.getItem('sheetsApiUrl') || '';

        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveData() {
            try {
                const data = {
                    blogPosts: blogPosts,
                    budgetItems: budgetItems,
                    schedules: schedules,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('familyData', JSON.stringify(data));
            } catch (error) {
                console.error('Ï†ÄÏû• Ïò§Î•ò:', error);
            }
        }

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        function loadData() {
            try {
                const data = localStorage.getItem('familyData');
                if (data) {
                    const parsed = JSON.parse(data);
                    blogPosts = (parsed.blogPosts || []).map(post => ({
                        ...post,
                        date: new Date(post.date)
                    }));
                    budgetItems = (parsed.budgetItems || []).map(item => ({
                        ...item,
                        date: new Date(item.date)
                    }));
                    schedules = (parsed.schedules || []).map(schedule => ({
                        ...schedule,
                        date: new Date(schedule.date)
                    }));
                } else {
                    // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞
                    blogPosts = [{
                        id: 1,
                        title: 'Í∞ÄÏ°± Ïó¨Ìñâ Í≥ÑÌöç',
                        content: 'Ïù¥Î≤à Ïó¨Î¶ÑÌú¥Í∞Ä Í≥ÑÌöçÏùÑ ÏÑ∏ÏõåÎ≥¥ÏïòÏäµÎãàÎã§.',
                        author: 'ÏóÑÎßà',
                        date: new Date('2025-08-01'),
                        authorId: 'mom'
                    }];
                    budgetItems = [
                        {
                            id: 1,
                            type: 'expense',
                            description: 'ÎßàÌä∏ Ïû•Î≥¥Í∏∞',
                            amount: 150000,
                            category: 'ÏãùÎπÑ',
                            author: 'ÏóÑÎßà',
                            date: new Date('2025-08-20'),
                            authorId: 'mom'
                        },
                        {
                            id: 2,
                            type: 'income',
                            description: 'ÏõîÍ∏â',
                            amount: 3000000,
                            category: 'Í∏âÏó¨',
                            author: 'ÏïÑÎπ†',
                            date: new Date('2025-08-01'),
                            authorId: 'dad'
                        }
                    ];
                    schedules = [{
                        id: 1,
                        title: 'Í∞ÄÏ°± Ïô∏Ïãù',
                        date: new Date('2025-08-25'),
                        time: '18:00',
                        description: 'Ï†ÄÎÖÅ Ïô∏Ïãù',
                        author: 'ÏóÑÎßà',
                        authorId: 'mom'
                    }];
                    saveData();
                }
            } catch (error) {
                console.error('Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        // Google Sheets URL ÏÑ§Ï†ï
        function setupSheetsUrl() {
            const url = prompt('Google Apps Script Ïõπ Ïï± URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:\n\nÏòàÏãú: https://script.google.com/macros/s/ABC123.../exec');
            if (url && url.includes('script.google.com/macros')) {
                sheetsApiUrl = url;
                localStorage.setItem('sheetsApiUrl', url);
                updateSheetsStatus(true);
                alert('‚úÖ Google Sheets URLÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\n\nÏù¥Ï†ú Îç∞Ïù¥ÌÑ∞Í∞Ä Google SheetsÏôÄ ÎèôÍ∏∞ÌôîÎê©ÎãàÎã§.');
                testConnection();
            } else if (url) {
                alert('‚ùå Ïò¨Î∞îÎ•∏ Google Apps Script URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.\n\nÌòïÏãù: https://script.google.com/macros/s/.../exec');
            }
        }

        // Ïó∞Í≤∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateSheetsStatus(connected) {
            const statusEl = document.getElementById('sheetsStatus');
            if (connected) {
                statusEl.textContent = 'üìä Google Sheets Ïó∞Í≤∞Îê® - Í∞ÄÏ°± Í∞Ñ Îç∞Ïù¥ÌÑ∞ Í≥µÏú† Í∞ÄÎä•!';
                statusEl.className = 'sheets-status';
            } else {
                statusEl.textContent = 'üìä Google Sheets Ïó∞Í≤∞ ÏïàÎê® - "Sheets Ïó∞Í≤∞" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî';
                statusEl.className = 'sheets-status disconnected';
            }
        }

        // Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
        async function testConnection() {
            if (!sheetsApiUrl) return;
            
            try {
                const response = await fetch(sheetsApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'test' })
                return merged;
        }

        function mergeSchedules(existing, newData) {
            const merged = [...existing];
            newData.forEach(newSchedule => {
                if (!merged.find(schedule => schedule.id === newSchedule.id)) {
                    merged.push(newSchedule);
                }
            });
            return merged;
        }

        // Î°úÍ∑∏Ïù∏
        function loginUser() {
            const id = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;

            if (users[id] && users[id].password === password) {
                currentUser = { id, ...users[id] };
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('welcomeMessage').textContent = currentUser.name + 'Îãò ÌôòÏòÅÌï©ÎãàÎã§!';
                
                if (currentUser.role === 'admin') {
                    document.getElementById('adminBadge').style.display = 'inline-block';
                    document.getElementById('adminTab').style.display = 'block';
                }
                
                // Google Sheets URL Î°úÎìú Î∞è ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                const savedUrl = localStorage.getItem('sheetsApiUrl');
                if (savedUrl) {
                    sheetsApiUrl = savedUrl;
                    updateSheetsStatus(true);
                    console.log('‚úÖ Google Sheets URL Î°úÎìúÎê®');
                } else {
                    updateSheetsStatus(false);
                }
                
                loadData();
                updateDashboard();
                loadBlogPosts();
                loadBudgetItems();
                loadSchedules();
                loadFinanceBoard();
                if (currentUser.role === 'admin') {
                    loadAdminPanel();
                }
            } else {
                alert('ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
            }
        }

        // Î°úÍ∑∏ÏïÑÏõÉ
        function logoutUser() {
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('adminBadge').style.display = 'none';
            document.getElementById('adminTab').style.display = 'none';
            document.getElementById('loginId').value = '';
            document.getElementById('loginPassword').value = '';
            showTab('dashboard');
        }

        // ÌÉ≠ Ï†ÑÌôò
        function showTab(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            event.target.classList.add('active');
        }

        // ÎåÄÏãúÎ≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateDashboard() {
            const currentMonth = new Date().getMonth();
            const monthlyExpenses = budgetItems
                .filter(item => item.type === 'expense' && item.date && item.date.getMonth() === currentMonth)
                .reduce((sum, item) => sum + (item.amount || 0), 0);
            
            document.getElementById('totalBudget').textContent = '‚Ç©' + monthlyExpenses.toLocaleString();
            document.getElementById('blogCount').textContent = blogPosts.length;
            document.getElementById('scheduleCount').textContent = schedules.length;

            const recentActivity = document.getElementById('recentActivity');
            recentActivity.innerHTML = '';
            
            const recent = [
                ...blogPosts.slice(-3).map(post => ({ type: 'blog', data: post })),
                ...budgetItems.slice(-3).map(item => ({ type: 'budget', data: item })),
                ...schedules.slice(-3).map(schedule => ({ type: 'schedule', data: schedule }))
            ].filter(activity => activity.data && activity.data.date)
             .sort((a, b) => new Date(b.data.date) - new Date(a.data.date))
             .slice(0, 5);

            recent.forEach(activity => {
                const card = document.createElement('div');
                card.className = 'card';
                
                let content = '';
                if (activity.type === 'blog') {
                    content = (activity.data.author || 'ÏùµÎ™Ö') + 'ÎãòÏù¥ "' + (activity.data.title || 'Ï†úÎ™©ÏóÜÏùå') + '" Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏Î•º ÏûëÏÑ±ÌñàÏäµÎãàÎã§.';
                } else if (activity.type === 'budget') {
                    const type = activity.data.type === 'income' ? 'ÏàòÏûÖ' : 'ÏßÄÏ∂ú';
                    content = (activity.data.author || 'ÏùµÎ™Ö') + 'ÎãòÏù¥ ' + type + ' "' + (activity.data.description || 'ÏÑ§Î™ÖÏóÜÏùå') + '"ÏùÑ(Î•º) ‚Ç©' + (activity.data.amount || 0).toLocaleString() + 'ÏúºÎ°ú Í∏∞Î°ùÌñàÏäµÎãàÎã§.';
                } else {
                    content = (activity.data.author || 'ÏùµÎ™Ö') + 'ÎãòÏù¥ "' + (activity.data.title || 'Ï†úÎ™©ÏóÜÏùå') + '" ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§.';
                }
                
                card.innerHTML = '<p><strong>' + content + '</strong></p><small style="color: #666;">' + (activity.data.date ? activity.data.date.toLocaleDateString() : 'ÎÇ†ÏßúÏóÜÏùå') + '</small>';
                recentActivity.appendChild(card);
            });
        }

        // Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏ Î°úÎìú
        function loadBlogPosts() {
            const container = document.getElementById('blogPosts');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!Array.isArray(blogPosts)) {
                blogPosts = [];
                return;
            }
            
            blogPosts.sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(0);
                const dateB = b.date ? new Date(b.date) : new Date(0);
                return dateB - dateA;
            }).forEach(post => {
                if (!post) return;
                
                const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.id === post.authorId);
                const postElement = document.createElement('div');
                postElement.className = 'card';
                
                const title = post.title || 'Ï†úÎ™©ÏóÜÏùå';
                const content = post.content || 'ÎÇ¥Ïö©ÏóÜÏùå';
                const author = post.author || 'ÏùµÎ™Ö';
                const date = post.date ? new Date(post.date).toLocaleDateString() : 'ÎÇ†ÏßúÏóÜÏùå';
                
                postElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h3 style="margin-bottom: 10px;">${title}</h3>
                            <p style="margin-bottom: 10px;">${content}</p>
                            <small style="color: #666;">ÏûëÏÑ±Ïûê: ${author} | ÎÇ†Ïßú: ${date}</small>
                        </div>
                        ${canEdit ? `<button class="btn btn-danger" onclick="removeBlogPost(${post.id || 0})" style="margin-left: 10px;">ÏÇ≠Ï†ú</button>` : ''}
                    </div>
                `;
                container.appendChild(postElement);
            });
        }

        // Í∞ÄÍ≥ÑÎ∂Ä Ìï≠Î™© Î°úÎìú
        function loadBudgetItems() {
            const container = document.getElementById('budgetItems');
            if (!container) return;
            
            container.innerHTML = '';
            
            let totalIncome = 0;
            let totalExpense = 0;
            
            budgetItems.sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(0);
                const dateB = b.date ? new Date(b.date) : new Date(0);
                return dateB - dateA;
            }).forEach(item => {
                if (!item) return;
                
                if (item.type === 'income') {
                    totalIncome += item.amount || 0;
                } else {
                    totalExpense += item.amount || 0;
                }
                
                const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.id === item.authorId);
                const itemElement = document.createElement('div');
                itemElement.className = 'expense-item';
                itemElement.innerHTML = `
                    <div>
                        <strong>${item.description || 'ÏÑ§Î™ÖÏóÜÏùå'}</strong><br>
                        <small>Ïπ¥ÌÖåÍ≥†Î¶¨: ${item.category || 'Í∏∞ÌÉÄ'} | ${item.author || 'ÏùµÎ™Ö'} | ${item.date ? new Date(item.date).toLocaleDateString() : 'ÎÇ†ÏßúÏóÜÏùå'}</small>
                    </div>
                    <div style="text-align: right;">
                        <div class="${item.type === 'income' ? 'income' : 'amount'}">${item.type === 'income' ? '+' : '-'}‚Ç©${(item.amount || 0).toLocaleString()}</div>
                        ${canEdit ? `<button class="btn btn-danger" onclick="removeBudgetItem(${item.id || 0})" style="margin-top: 5px;">ÏÇ≠Ï†ú</button>` : ''}
                    </div>
                `;
                container.appendChild(itemElement);
            });
            
            document.getElementById('totalIncome').textContent = '‚Ç©' + totalIncome.toLocaleString();
            document.getElementById('totalExpense').textContent = '‚Ç©' + totalExpense.toLocaleString();
            document.getElementById('netAmount').textContent = '‚Ç©' + (totalIncome - totalExpense).toLocaleString();
        }

        // ÏùºÏ†ï Î°úÎìú
        function loadSchedules() {
            const container = document.getElementById('calendarView');
            if (!container) return;
            
            container.innerHTML = '';
            
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const calendarHeader = document.createElement('h3');
            calendarHeader.textContent = year + 'ÎÖÑ ' + (month + 1) + 'Ïõî';
            calendarHeader.style.textAlign = 'center';
            calendarHeader.style.marginBottom = '20px';
            container.appendChild(calendarHeader);
            
            const daysOfWeek = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            const calendarGrid = document.createElement('div');
            calendarGrid.className = 'calendar';
            
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day';
                calendarGrid.appendChild(emptyCell);
            }
            
            for (let date = 1; date <= lastDate; date++) {
                const dateCell = document.createElement('div');
                dateCell.className = 'calendar-day';
                
                const today = new Date();
                if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dateCell.classList.add('today');
                }
                
                dateCell.innerHTML = '<strong>' + date + '</strong>';
                
                const daySchedules = schedules.filter(s => 
                    s.date && s.date.getDate() === date && 
                    s.date.getMonth() === month && 
                    s.date.getFullYear() === year
                );
                
                daySchedules.forEach(schedule => {
                    const scheduleDiv = document.createElement('div');
                    scheduleDiv.style.fontSize = '10px';
                    scheduleDiv.style.background = '#667eea';
                    scheduleDiv.style.color = 'white';
                    scheduleDiv.style.padding = '2px 4px';
                    scheduleDiv.style.borderRadius = '4px';
                    scheduleDiv.style.marginTop = '2px';
                    scheduleDiv.textContent = (schedule.time || '') + ' ' + (schedule.title || '');
                    dateCell.appendChild(scheduleDiv);
                });
                
                calendarGrid.appendChild(dateCell);
            }
            
            container.appendChild(calendarGrid);
            
            const scheduleList = document.createElement('div');
            scheduleList.style.marginTop = '30px';
            scheduleList.innerHTML = '<h3>Ïù¥Î≤à Îã¨ ÏùºÏ†ï</h3>';
            
            const monthSchedules = schedules.filter(s => 
                s.date && s.date.getMonth() === month && s.date.getFullYear() === year
            ).sort((a, b) => a.date - b.date);
            
            monthSchedules.forEach(schedule => {
                const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.id === schedule.authorId);
                const scheduleElement = document.createElement('div');
                scheduleElement.className = 'card';
                scheduleElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${schedule.title || 'Ï†úÎ™©ÏóÜÏùå'}</strong><br>
                            <small>${schedule.date ? schedule.date.toLocaleDateString() : 'ÎÇ†ÏßúÏóÜÏùå'} ${schedule.time || ''} | ${schedule.author || 'ÏùµÎ™Ö'}</small><br>
                            <span>${schedule.description || ''}</span>
                        </div>
                        ${canEdit ? `<button class="btn btn-danger" onclick="removeSchedule(${schedule.id || 0})">ÏÇ≠Ï†ú</button>` : ''}
                    </div>
                `;
                scheduleList.appendChild(scheduleElement);
            });
            
            container.appendChild(scheduleList);
        }

        // Ïû¨Ï†ïÌòÑÌô© Î°úÎìú
        function loadFinanceBoard() {
            const container = document.getElementById('financeBoard');
            if (!container) return;
            
            container.innerHTML = '';
            
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const months = [];
            
            for (let i = 0; i < 12; i++) {
                const monthlyIncome = budgetItems
                    .filter(item => item.type === 'income' && 
                           item.date && item.date.getMonth() === i && 
                           item.date.getFullYear() === currentYear)
                    .reduce((sum, item) => sum + (item.amount || 0), 0);
                
                const monthlyExpense = budgetItems
                    .filter(item => item.type === 'expense' && 
                           item.date && item.date.getMonth() === i && 
                           item.date.getFullYear() === currentYear)
                    .reduce((sum, item) => sum + (item.amount || 0), 0);
                
                if (monthlyIncome > 0 || monthlyExpense > 0) {
                    months.push({
                        month: (i + 1) + 'Ïõî',
                        income: monthlyIncome,
                        expense: monthlyExpense,
                        net: monthlyIncome - monthlyExpense
                    });
                }
            }
            
            const summaryCard = document.createElement('div');
            summaryCard.className = 'card';
            summaryCard.innerHTML = `
                <h3>${currentYear}ÎÖÑ ÏõîÎ≥Ñ Ïû¨Ï†ï ÌòÑÌô©</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 10px; border: 1px solid #ddd;">Ïõî</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">ÏàòÏûÖ</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">ÏßÄÏ∂ú</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">ÏàúÏàòÏûÖ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${months.map(m => `
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">${m.month}</td>
                                    <td style="padding: 10px; border: 1px solid #ddd; color: #27ae60;">‚Ç©${m.income.toLocaleString()}</td>
                                    <td style="padding: 10px; border: 1px solid #ddd; color: #e74c3c;">‚Ç©${m.expense.toLocaleString()}</td>
                                    <td style="padding: 10px; border: 1px solid #ddd; color: ${m.net >= 0 ? '#27ae60' : '#e74c3c'};">‚Ç©${m.net.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            container.appendChild(summaryCard);
        }

        // Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê Î°úÎìú
        function loadAdminPanel() {
            const userList = document.getElementById('userList');
            if (!userList) return;
            
            userList.innerHTML = '';
            
            Object.entries(users).forEach(([id, user]) => {
                const userElement = document.createElement('div');
                userElement.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f8f9fa;border-radius:8px;margin-bottom:10px;';
                userElement.innerHTML = `
                    <div>
                        <strong>${user.name}</strong> (${id})<br>
                        <small>Í∂åÌïú: ${user.role === 'admin' ? 'Í¥ÄÎ¶¨Ïûê' : 'ÏÇ¨Ïö©Ïûê'}</small>
                    </div>
                    ${id !== 'admin' ? `<button class="btn btn-danger" onclick="removeUser('${id}')">ÏÇ≠Ï†ú</button>` : ''}
                `;
                userList.appendChild(userElement);
            });
            
            const systemStats = document.getElementById('systemStats');
            if (systemStats) {
                systemStats.innerHTML = `
                    <div style="margin-bottom: 15px;"><strong>Ï¥ù ÏÇ¨Ïö©Ïûê:</strong> ${Object.keys(users).length}Î™Ö</div>
                    <div style="margin-bottom: 15px;"><strong>Ï¥ù Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏:</strong> ${blogPosts.length}Í∞ú</div>
                    <div style="margin-bottom: 15px;"><strong>Ï¥ù Í∞ÄÍ≥ÑÎ∂Ä Ìï≠Î™©:</strong> ${budgetItems.length}Í∞ú</div>
                    <div style="margin-bottom: 15px;"><strong>Ï¥ù ÏùºÏ†ï:</strong> ${schedules.length}Í∞ú</div>
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="exportData()">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                        <button class="btn" onclick="clearAllData()" style="margin-left: 10px; background: #e74c3c;">Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</button>
                    </div>
                `;
            }
        }

        // Î™®Îã¨ Ìï®ÏàòÎì§
        function openBlogModal() {
            const modal = document.getElementById('blogModal');
            if (modal) modal.style.display = 'block';
        }

        function closeBlogModal() {
            const modal = document.getElementById('blogModal');
            const titleElement = document.getElementById('blogTitle');
            const contentElement = document.getElementById('blogContent');
            
            if (modal) modal.style.display = 'none';
            if (titleElement) titleElement.value = '';
            if (contentElement) contentElement.value = '';
        }

        function openBudgetModal() {
            const modal = document.getElementById('budgetModal');
            if (modal) modal.style.display = 'block';
        }

        function closeBudgetModal() {
            const modal = document.getElementById('budgetModal');
            const descriptionElement = document.getElementById('budgetDescription');
            const amountElement = document.getElementById('budgetAmount');
            
            if (modal) modal.style.display = 'none';
            if (descriptionElement) descriptionElement.value = '';
            if (amountElement) amountElement.value = '';
        }

        function openScheduleModal() {
            const modal = document.getElementById('scheduleModal');
            const dateElement = document.getElementById('scheduleDate');
            
            if (modal) modal.style.display = 'block';
            if (dateElement) {
                const today = new Date();
                dateElement.value = today.toISOString().split('T')[0];
            }
        }

        function closeScheduleModal() {
            const modal = document.getElementById('scheduleModal');
            const titleElement = document.getElementById('scheduleTitle');
            const dateElement = document.getElementById('scheduleDate');
            const timeElement = document.getElementById('scheduleTime');
            const descriptionElement = document.getElementById('scheduleDescription');
            
            if (modal) modal.style.display = 'none';
            if (titleElement) titleElement.value = '';
            if (dateElement) dateElement.value = '';
            if (timeElement) timeElement.value = '';
            if (descriptionElement) descriptionElement.value = '';
        }

        // Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä Ìï®ÏàòÎì§
        async function saveBlogPost() {
            const title = document.getElementById('blogTitle').value;
            const content = document.getElementById('blogContent').value;
            
            if (!title || !content) {
                alert('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }
            
            const newPost = {
                id: Date.now(),
                title: title,
                content: content,
                author: currentUser.name,
                authorId: currentUser.id,
                date: new Date()
            };
            
            blogPosts.push(newPost);
            saveData();
            
            // Google SheetsÏóêÎèÑ Ï†ÄÏû• ÏãúÎèÑ
            if (sheetsApiUrl) {
                const success = await saveToSheets('blog', newPost);
                if (success) {
                    console.log('‚úÖ Google SheetsÏóê Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏ Ï†ÄÏû•Îê®');
                }
            }
            
            loadBlogPosts();
            updateDashboard();
            closeBlogModal();
        }

        async function saveBudgetItem() {
            const type = document.getElementById('budgetType').value;
            const description = document.getElementById('budgetDescription').value;
            const amount = parseInt(document.getElementById('budgetAmount').value);
            const category = document.getElementById('budgetCategory').value;
            
            if (!description || !amount || isNaN(amount)) {
                alert('ÎÇ¥Ïö©Í≥º Ïò¨Î∞îÎ•∏ Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                type: type,
                description: description,
                amount: amount,
                category: category,
                author: currentUser.name,
                authorId: currentUser.id,
                date: new Date()
            };
            
            budgetItems.push(newItem);
            saveData();
            
            // Google SheetsÏóêÎèÑ Ï†ÄÏû• ÏãúÎèÑ
            if (sheetsApiUrl) {
                const success = await saveToSheets('budget', newItem);
                if (success) {
                    console.log('‚úÖ Google SheetsÏóê Í∞ÄÍ≥ÑÎ∂Ä Ìï≠Î™© Ï†ÄÏû•Îê®');
                }
            }
            
            loadBudgetItems();
            loadFinanceBoard();
            updateDashboard();
            closeBudgetModal();
        }

        async function saveSchedule() {
            const title = document.getElementById('scheduleTitle').value;
            const dateValue = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;
            const description = document.getElementById('scheduleDescription').value;
            
            if (!title || !dateValue || !time) {
                alert('Ï†úÎ™©, ÎÇ†Ïßú, ÏãúÍ∞ÑÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }
            
            const date = new Date(dateValue);
            if (isNaN(date.getTime())) {
                alert('Ïò¨Î∞îÎ•∏ ÎÇ†ÏßúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const newSchedule = {
                id: Date.now(),
                title: title,
                date: date,
                time: time,
                description: description || '',
                author: currentUser.name,
                authorId: currentUser.id
            };
            
            schedules.push(newSchedule);
            saveData();
            
            // Google SheetsÏóêÎèÑ Ï†ÄÏû• ÏãúÎèÑ
            if (sheetsApiUrl) {
                const success = await saveToSheets('schedule', newSchedule);
                if (success) {
                    console.log('‚úÖ Google SheetsÏóê ÏùºÏ†ï Ï†ÄÏû•Îê®');
                }
            }
            
            loadSchedules();
            updateDashboard();
            closeScheduleModal();
        }

        // ÏÇ≠Ï†ú Ìï®ÏàòÎì§
        function removeBlogPost(id) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ Ìè¨Ïä§Ìä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            blogPosts = blogPosts.filter(post => post.id !== id);
            saveData();
            loadBlogPosts();
            updateDashboard();
        }

        function removeBudgetItem(id) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            budgetItems = budgetItems.filter(item => item.id !== id);
            saveData();
            loadBudgetItems();
            loadFinanceBoard();
            updateDashboard();
        }

        function removeSchedule(id) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            schedules = schedules.filter(schedule => schedule.id !== id);
            saveData();
            loadSchedules();
            updateDashboard();
        }

        function removeUser(userId) {
            if (!users[userId]) return;
            
            if (!confirm('Ï†ïÎßêÎ°ú ' + users[userId].name + ' ÏÇ¨Ïö©ÏûêÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            delete users[userId];
            loadAdminPanel();
        }

        // Í¥ÄÎ¶¨Ïûê Í∏∞Îä•
        function exportData() {
            const data = {
                users: users,
                blogPosts: blogPosts,
                budgetItems: budgetItems,
                schedules: schedules,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'family_data_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function clearAllData() {
            if (!confirm('Ï†ïÎßêÎ°ú Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            if (!confirm('Îã§Ïãú Ìïú Î≤à ÌôïÏù∏Ìï©ÎãàÎã§. Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) return;
            
            blogPosts = [];
            budgetItems = [];
            schedules = [];
            saveData();
            updateDashboard();
            loadBlogPosts();
            loadBudgetItems();
            loadSchedules();
            loadFinanceBoard();
            loadAdminPanel();
            alert('Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Í∞ÄÏ°± Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú ÏãúÏûë');
            
            // Google Sheets URL Î°úÎìú
            const savedUrl = localStorage.getItem('sheetsApiUrl');
            if (savedUrl) {
                sheetsApiUrl = savedUrl;
                updateSheetsStatus(true);
            } else {
                updateSheetsStatus(false);
            }
            
            loadData();
            
            // ÏóîÌÑ∞ ÌÇ§Î°ú Î°úÍ∑∏Ïù∏
            const loginPassword = document.getElementById('loginPassword');
            if (loginPassword) {
                loginPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loginUser();
                    }
                });
            }
            
            // ÌéòÏù¥ÏßÄ Ï¢ÖÎ£å Ïãú ÏûêÎèô Ï†ÄÏû•
            window.addEventListener('beforeunload', function() {
                if (currentUser) {
                    saveData();
                }
            });
            
            console.log('‚úÖ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        });
    </script>
</body>
</html>
                const result = await response.json();
                if (result.success) {
                    updateSheetsStatus(true);
                    console.log('‚úÖ Google Sheets Ïó∞Í≤∞ ÏÑ±Í≥µ');
                }
            } catch (error) {
                console.error('Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïò§Î•ò:', error);
                updateSheetsStatus(false);
            }
        }

        // Google SheetsÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        async function saveToSheets(type, data) {
            if (!sheetsApiUrl) {
                console.log('Google Sheets URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏùå');
                return false;
            }

            try {
                const response = await fetch(sheetsApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'save',
                        type: type,
                        data: data
                    })
                });
                const result = await response.json();
                if (result.success) {
                    console.log('‚úÖ Google Sheets Ï†ÄÏû• ÏÑ±Í≥µ:', type);
                    return true;
                } else {
                    console.error('‚ùå Sheets Ï†ÄÏû• Ïã§Ìå®:', result.error);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Sheets Ï†ÄÏû• Ïò§Î•ò:', error);
                return false;
            }
        }

        // ÎèôÍ∏∞Ìôî Ìï®Ïàò
        async function syncWithSheets() {
            if (!sheetsApiUrl) {
                alert('‚ùå Google Sheets URLÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.\n\n"üìä Sheets Ïó∞Í≤∞" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch(sheetsApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'load' })
                });
                const result = await response.json();
                
                if (result.success && result.data) {
                    parseSheetData(result.data);
                    updateDashboard();
                    loadBlogPosts();
                    loadBudgetItems();
                    alert('üîÑ ÎèôÍ∏∞Ìôî ÏôÑÎ£å!\n\nGoogle SheetsÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                } else {
                    alert('‚ùå ÎèôÍ∏∞Ìôî Ïã§Ìå®\n\nGoogle SheetsÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('ÎèôÍ∏∞Ìôî Ïò§Î•ò:', error);
                alert('‚ùå ÎèôÍ∏∞Ìôî Ïã§Ìå®\n\n' + error.message);
            }
        }

        // Sheets Îç∞Ïù¥ÌÑ∞ ÌååÏã±
        function parseSheetData(sheetData) {
            const newBlogPosts = [];
            const newBudgetItems = [];
            const newSchedules = [];

            sheetData.slice(1).forEach(row => {
                if (row[1] && row[2]) {
                    try {
                        const data = JSON.parse(row[2]);
                        
                        if (row[1] === 'blog') {
                            newBlogPosts.push({
                                ...data,
                                date: new Date(data.date)
                            });
                        } else if (row[1] === 'budget') {
                            newBudgetItems.push({
                                ...data,
                                date: new Date(data.date)
                            });
                        } else if (row[1] === 'schedule') {
                            newSchedules.push({
                                ...data,
                                date: new Date(data.date)
                            });
                        }
                    } catch (e) {
                        console.error('Îç∞Ïù¥ÌÑ∞ ÌååÏã± Ïò§Î•ò:', e);
                    }
                }
            });

            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ÏôÄ Î≥ëÌï© (Ï§ëÎ≥µ Ï†úÍ±∞)
            blogPosts = mergePosts(blogPosts, newBlogPosts);
            budgetItems = mergeItems(budgetItems, newBudgetItems);
            schedules = mergeSchedules(schedules, newSchedules);
            
            // Î°úÏª¨ÏóêÎèÑ Ï†ÄÏû•
            saveData();
        }

        // Îç∞Ïù¥ÌÑ∞ Î≥ëÌï© Ìï®ÏàòÎì§
        function mergePosts(existing, newData) {
            const merged = [...existing];
            newData.forEach(newPost => {
                if (!merged.find(post => post.id === newPost.id)) {
                    merged.push(newPost);
                }
            });
            return merged;
        }

        function mergeItems(existing, newData) {
            const merged = [...existing];
            newData.forEach(newItem => {
                if (!merged.find(item => item.id === newItem.id)) {
                    merged.push(newItem);
                }
            });
